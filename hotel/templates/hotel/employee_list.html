{% extends 'hotel/base.html' %}

{% block title %}Employés - Gestion Hôtel{% endblock %}

{% block page_title %}
<i class="fas fa-user-tie"></i>
<span>Gestion des employés</span>
{% endblock %}

{% block content %}
<div class="employee-management-container">
    <!-- En-tête avec statistiques -->
    <div class="dashboard-header">
        <div class="header-content">
            <div class="header-title">
                <h1>Gestion du personnel</h1>
                <p class="header-subtitle">Gérez vos équipes et les ressources humaines</p>
            </div>
            <a href="{% url 'create_employee' %}" class="btn btn-primary btn-add-employee">
                <i class="fas fa-user-plus"></i>
                <span>Nouvel employé</span>
            </a>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon total-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number">{{ total_employees }}</div>
                    <div class="stat-label">Employés total</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon active-icon">
                    <i class="fas fa-user-check"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number">{{ active_employees }}</div>
                    <div class="stat-label">Actifs</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon admin-icon">
                    <i class="fas fa-crown"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number">{{ admin_count }}</div>
                    <div class="stat-label">Administrateurs</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon salary-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number">{{ average_salary|floatformat:0|default:"0" }}</div>
                    <div class="stat-label">Salaire moyen (€)</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recherche et filtres -->
    <div class="search-filters-card">
        <div class="card-header">
            <h3><i class="fas fa-filter"></i> Filtres & Recherche</h3>
            <div class="header-actions">
                <button class="btn btn-secondary btn-export" onclick="exportEmployees()">
                    <i class="fas fa-file-export"></i> Exporter
                </button>
                <button class="btn btn-secondary btn-bulk" onclick="showBulkActions()">
                    <i class="fas fa-tasks"></i> Actions groupées
                </button>
            </div>
        </div>
        
        <div class="card-body">
            <form method="get" class="search-form">
                <div class="search-container">
                    <div class="search-input-group">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" 
                               class="search-input" 
                               name="q" 
                               value="{{ q|default:'' }}"
                               placeholder="Rechercher un employé (nom, email, poste, téléphone...)"
                               autocomplete="off">
                        <div class="search-suggestions" id="search-suggestions"></div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary search-btn">
                        <i class="fas fa-search"></i> Rechercher
                    </button>
                </div>
                
                <div class="filter-options">
                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-user-tag"></i> Poste
                        </label>
                        <select name="poste" class="filter-select" onchange="this.form.submit()">
                            <option value="">Tous les postes</option>
                            {% for p in postes_choices %}
                                <option value="{{ p }}" {% if p == poste_filter %}selected{% endif %}>{{ p }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-user-check"></i> Statut
                        </label>
                        <select name="is_active" class="filter-select" onchange="this.form.submit()">
                            <option value="">Tous les statuts</option>
                            <option value="1" {% if is_active_filter == '1' %}selected{% endif %}>Actifs</option>
                            <option value="0" {% if is_active_filter == '0' %}selected{% endif %}>Inactifs</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-sort-amount-down"></i> Trier par
                        </label>
                        <select name="sort" class="filter-select" onchange="this.form.submit()">
                            <option value="name_asc" {% if sort_by == 'name_asc' %}selected{% endif %}>Nom (A-Z)</option>
                            <option value="name_desc" {% if sort_by == 'name_desc' %}selected{% endif %}>Nom (Z-A)</option>
                            <option value="date_desc" {% if sort_by == 'date_desc' %}selected{% endif %}>Plus récents</option>
                            <option value="date_asc" {% if sort_by == 'date_asc' %}selected{% endif %}>Plus anciens</option>
                            <option value="salary_desc" {% if sort_by == 'salary_desc' %}selected{% endif %}>Salaire (↓)</option>
                            <option value="salary_asc" {% if sort_by == 'salary_asc' %}selected{% endif %}>Salaire (↑)</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-eye"></i> Afficher
                        </label>
                        <select name="per_page" class="filter-select" onchange="this.form.submit()">
                            <option value="9" {% if per_page == 9 %}selected{% endif %}>9 par page</option>
                            <option value="18" {% if per_page == 18 %}selected{% endif %}>18 par page</option>
                            <option value="36" {% if per_page == 36 %}selected{% endif %}>36 par page</option>
                            <option value="all" {% if per_page == 'all' %}selected{% endif %}>Tous</option>
                        </select>
                    </div>
                </div>
            </form>
            
            {% if q or poste_filter or is_active_filter %}
            <div class="active-filters">
                <div class="filters-label">
                    <i class="fas fa-filter"></i> Filtres actifs :
                </div>
                <div class="filter-chips">
                    {% if q %}
                    <span class="filter-chip">
                        Recherche : "{{ q }}"
                        <a href="?{% if poste_filter %}poste={{ poste_filter }}&{% endif %}{% if is_active_filter %}is_active={{ is_active_filter }}&{% endif %}{% if sort_by %}sort={{ sort_by }}&{% endif %}{% if per_page %}per_page={{ per_page }}{% endif %}" class="chip-remove">
                            <i class="fas fa-times"></i>
                        </a>
                    </span>
                    {% endif %}
                    {% if poste_filter %}
                    <span class="filter-chip">
                        Poste : {{ poste_filter }}
                        <a href="?{% if q %}q={{ q }}&{% endif %}{% if is_active_filter %}is_active={{ is_active_filter }}&{% endif %}{% if sort_by %}sort={{ sort_by }}&{% endif %}{% if per_page %}per_page={{ per_page }}{% endif %}" class="chip-remove">
                            <i class="fas fa-times"></i>
                        </a>
                    </span>
                    {% endif %}
                    {% if is_active_filter %}
                    <span class="filter-chip">
                        Statut : {% if is_active_filter == '1' %}Actifs{% else %}Inactifs{% endif %}
                        <a href="?{% if q %}q={{ q }}&{% endif %}{% if poste_filter %}poste={{ poste_filter }}&{% endif %}{% if sort_by %}sort={{ sort_by }}&{% endif %}{% if per_page %}per_page={{ per_page }}{% endif %}" class="chip-remove">
                            <i class="fas fa-times"></i>
                        </a>
                    </span>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Liste des employés -->
    <div class="employees-list-card">
        <div class="card-header">
            <h3><i class="fas fa-list"></i> Liste des employés</h3>
            <div class="list-info">
                <span class="employees-count">{{ employees|length }} employé(s)</span>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="grid">
                        <i class="fas fa-th"></i>
                    </button>
                    <button class="view-btn" data-view="list">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="card-body">
            {% if employees %}
            <div class="employees-grid" id="employeesView">
                {% for employee in employees %}
                <div class="employee-card">
                    <div class="employee-card-header">
                        <div class="employee-avatar">
                            <span>{{ employee.username|slice:":1"|upper }}</span>
                            {% if employee.is_superuser %}
                            <div class="avatar-badge admin-badge" title="Administrateur">
                                <i class="fas fa-crown"></i>
                            </div>
                            {% elif employee.is_staff %}
                            <div class="avatar-badge staff-badge" title="Staff">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            {% endif %}
                        </div>
                        <div class="employee-info">
                            <h4 class="employee-name">{{ employee.get_full_name|default:employee.username }}</h4>
                            <div class="employee-email">{{ employee.email|default:"Pas d'email" }}</div>
                            <div class="employee-id">
                                <i class="fas fa-hashtag"></i> ID: {{ employee.id }}
                            </div>
                        </div>
                        <div class="employee-status">
                            {% if employee.is_active %}
                            <span class="status-badge status-active">
                                <i class="fas fa-check-circle"></i> Actif
                            </span>
                            {% else %}
                            <span class="status-badge status-inactive">
                                <i class="fas fa-times-circle"></i> Inactif
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="employee-details">
                        <div class="detail-item">
                            <i class="fas fa-user-tag"></i>
                            <div class="detail-content">
                                <span class="detail-label">Poste</span>
                                <span class="detail-value">{{ employee.profile.poste|default:"Non défini" }}</span>
                            </div>
                        </div>
                        
                        <div class="detail-item">
                            <i class="fas fa-money-bill-wave"></i>
                            <div class="detail-content">
                                <span class="detail-label">Salaire</span>
                                <span class="detail-value">
                                    {% if employee.profile.salaire %}
                                        {{ employee.profile.salaire|floatformat:2 }} €
                                    {% else %}
                                        Non défini
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        
                        <div class="detail-item">
                            <i class="fas fa-calendar-alt"></i>
                            <div class="detail-content">
                                <span class="detail-label">Embauché le</span>
                                <span class="detail-value">
                                    {% if employee.profile.date_embauche %}
                                        {{ employee.profile.date_embauche|date:"d/m/Y" }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        
                        <div class="detail-item">
                            <i class="fas fa-shield-alt"></i>
                            <div class="detail-content">
                                <span class="detail-label">Accès</span>
                                <span class="detail-value">
                                    {% if employee.is_superuser %}
                                        Administrateur
                                    {% elif employee.is_staff %}
                                        Staff
                                    {% else %}
                                        Utilisateur
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="employee-stats">
                        <div class="employee-stat">
                            <i class="fas fa-calendar-check"></i>
                            <div class="stat-content">
                                <div class="stat-number">
                                    {% with seniority=employee.profile.get_seniority_years %}
                                        {{ seniority|default:"0" }}
                                    {% endwith %}
                                </div>
                                <div class="stat-label">année(s)</div>
                            </div>
                        </div>
                        
                        {% if employee.profile.statut_employe %}
                        <div class="employee-stat">
                            <i class="fas fa-user-clock"></i>
                            <div class="stat-content">
                                <div class="stat-status">
                                    {% if employee.profile.statut_employe == 'actif' %}
                                        Actif
                                    {% elif employee.profile.statut_employe == 'conge' %}
                                        Congé
                                    {% else %}
                                        Renvoyé
                                    {% endif %}
                                </div>
                                <div class="stat-label">Statut</div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="employee-actions">
                        <div class="action-group">
                            <a href="{% url 'employee_update' employee.pk %}" class="btn-action btn-edit" title="Modifier">
                                <i class="fas fa-edit"></i>
                                <span>Modifier</span>
                            </a>
                            
                            <a href="{% url 'employee_change_salary' employee.pk %}" class="btn-action btn-salary" title="Modifier salaire">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>Salaire</span>
                            </a>
                        </div>
                        
                        <div class="action-group">
                            <a href="{% url 'employee_change_role' employee.pk %}" class="btn-action btn-role" title="Changer rôle">
                                <i class="fas fa-shield-alt"></i>
                                <span>Rôle</span>
                            </a>
                            
                            <a href="{% url 'employee_promote' employee.pk %}" class="btn-action btn-promote" title="Promouvoir">
                                <i class="fas fa-star"></i>
                                <span>Promouvoir</span>
                            </a>
                        </div>
                        
                        <div class="action-group">
                            <a href="{% url 'employee_terminate' employee.pk %}" class="btn-action btn-terminate" title="Gérer fin de contrat">
                                <i class="fas fa-user-slash"></i>
                                <span>Fin contrat</span>
                            </a>
                            
                            <a href="{% url 'employee_history' employee.pk %}" class="btn-action btn-history" title="Historique">
                                <i class="fas fa-history"></i>
                                <span>Historique</span>
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Vue liste (cachée par défaut) -->
            <div class="employees-table" id="employeesTable" style="display: none;">
                <table class="employees-data-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Email</th>
                            <th>Poste</th>
                            <th>Salaire</th>
                            <th>Statut</th>
                            <th>Accès</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for employee in employees %}
                        <tr>
                            <td>
                                <div class="table-employee-info">
                                    <div class="table-avatar">
                                        {{ employee.username|slice:":1"|upper }}
                                    </div>
                                    <div class="table-details">
                                        <div class="table-name">{{ employee.get_full_name|default:employee.username }}</div>
                                        <div class="table-id">ID: {{ employee.id }}</div>
                                    </div>
                                </div>
                            </td>
                            <td>{{ employee.email|default:"-" }}</td>
                            <td>{{ employee.profile.poste|default:"-" }}</td>
                            <td>
                                {% if employee.profile.salaire %}
                                    {{ employee.profile.salaire|floatformat:2 }} €
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                {% if employee.is_active %}
                                    <span class="table-badge active">Actif</span>
                                {% else %}
                                    <span class="table-badge inactive">Inactif</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if employee.is_superuser %}
                                    <span class="table-badge admin">Admin</span>
                                {% elif employee.is_staff %}
                                    <span class="table-badge staff">Staff</span>
                                {% else %}
                                    <span class="table-badge user">User</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="table-actions">
                                    <a href="{% url 'employee_update' employee.pk %}" class="table-action" title="Modifier">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a href="{% url 'employee_change_salary' employee.pk %}" class="table-action" title="Salaire">
                                        <i class="fas fa-money-bill-wave"></i>
                                    </a>
                                    <a href="{% url 'employee_change_role' employee.pk %}" class="table-action" title="Rôle">
                                        <i class="fas fa-shield-alt"></i>
                                    </a>
                                    <a href="{% url 'employee_terminate' employee.pk %}" class="table-action" title="Fin contrat">
                                        <i class="fas fa-user-slash"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            {% if page_obj and page_obj.paginator.num_pages > 1 %}
            <div class="pagination-container">
                <div class="pagination-info">
                    Affichage de {{ employees|length }} employé(s) sur {{ total_employees }}
                </div>
                <div class="pagination">
                    {% if page_obj.has_previous %}
                    <a href="?page=1{% if q %}&q={{ q }}{% endif %}{% if poste_filter %}&poste={{ poste_filter }}{% endif %}{% if is_active_filter %}&is_active={{ is_active_filter }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="pagination-btn">
                        <i class="fas fa-angle-double-left"></i>
                    </a>
                    <a href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q }}{% endif %}{% if poste_filter %}&poste={{ poste_filter }}{% endif %}{% if is_active_filter %}&is_active={{ is_active_filter }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="pagination-btn">
                        <i class="fas fa-angle-left"></i>
                    </a>
                    {% endif %}
                    
                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                        <span class="pagination-btn active">{{ num }}</span>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <a href="?page={{ num }}{% if q %}&q={{ q }}{% endif %}{% if poste_filter %}&poste={{ poste_filter }}{% endif %}{% if is_active_filter %}&is_active={{ is_active_filter }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="pagination-btn">{{ num }}</a>
                        {% endif %}
                    {% endfor %}
                    
                    {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q }}{% endif %}{% if poste_filter %}&poste={{ poste_filter }}{% endif %}{% if is_active_filter %}&is_active={{ is_active_filter }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="pagination-btn">
                        <i class="fas fa-angle-right"></i>
                    </a>
                    <a href="?page={{ page_obj.paginator.num_pages }}{% if q %}&q={{ q }}{% endif %}{% if poste_filter %}&poste={{ poste_filter }}{% endif %}{% if is_active_filter %}&is_active={{ is_active_filter }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="pagination-btn">
                        <i class="fas fa-angle-double-right"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-user-tie"></i>
                </div>
                <h3>Aucun employé trouvé</h3>
                <p>
                    {% if q or poste_filter or is_active_filter %}
                    Aucun employé ne correspond à vos critères de recherche.
                    {% else %}
                    Aucun employé n'est enregistré dans le système.
                    {% endif %}
                </p>
                <a href="{% url 'create_employee' %}" class="btn btn-primary">
                    <i class="fas fa-user-plus"></i> Ajouter votre premier employé
                </a>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Quick Stats -->
    <div class="quick-stats-card">
        <h3><i class="fas fa-chart-pie"></i> Statistiques rapides</h3>
        <div class="stats-grid-small">
            <div class="stat-item-small">
                <div class="stat-icon-small">
                    <i class="fas fa-user-tag"></i>
                </div>
                <div class="stat-content-small">
                    <div class="stat-number-small">{{ postes_count|default:"0" }}</div>
                    <div class="stat-label-small">Postes différents</div>
                </div>
            </div>
            
            <div class="stat-item-small">
                <div class="stat-icon-small">
                    <i class="fas fa-calendar-plus"></i>
                </div>
                <div class="stat-content-small">
                    <div class="stat-number-small">{{ new_this_month|default:"0" }}</div>
                    <div class="stat-label-small">Nouveaux ce mois</div>
                </div>
            </div>
            
            <div class="stat-item-small">
                <div class="stat-icon-small">
                    <i class="fas fa-euro-sign"></i>
                </div>
                <div class="stat-content-small">
                    <div class="stat-number-small">{{ total_payroll|floatformat:0|default:"0" }}</div>
                    <div class="stat-label-small">Masse salariale/mois</div>
                </div>
            </div>
            
            <div class="stat-item-small">
                <div class="stat-icon-small">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-content-small">
                    <div class="stat-number-small">{{ turnover_rate|default:"0" }}%</div>
                    <div class="stat-label-small">Taux de rotation</div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Styles spécifiques pour la gestion des employés */
    .employee-management-container {
        max-width: 1400px;
        margin: 0 auto;
    }
    
    /* Dashboard Header */
    .dashboard-header {
        margin-bottom: 2rem;
    }
    
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }
    
    .header-title h1 {
        color: var(--primary-blue);
        margin: 0 0 0.5rem 0;
        font-size: 2rem;
    }
    
    .header-subtitle {
        color: var(--text-light);
        margin: 0;
        font-size: 1rem;
    }
    
    .btn-add-employee {
        display: inline-flex;
        align-items: center;
        gap: 0.8rem;
        padding: 0.9rem 1.8rem;
        background: linear-gradient(135deg, var(--secondary-blue), var(--accent-blue));
        color: white;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        transition: var(--transition);
    }
    
    .btn-add-employee:hover {
        background: linear-gradient(135deg, var(--accent-blue), #2980b9);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
    }
    
    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: var(--shadow);
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: var(--transition);
        border: 1px solid #e9ecef;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
    }
    
    .total-icon { background: linear-gradient(135deg, var(--secondary-blue), var(--accent-blue)); }
    .active-icon { background: linear-gradient(135deg, var(--success-green), #27ae60); }
    .admin-icon { background: linear-gradient(135deg, var(--purple), #8e44ad); }
    .salary-icon { background: linear-gradient(135deg, var(--warning-orange), #f39c12); }
    
    .stat-content {
        flex: 1;
    }
    
    .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-blue);
        line-height: 1;
    }
    
    .stat-label {
        font-size: 0.9rem;
        color: var(--text-light);
        margin-top: 0.3rem;
    }
    
    /* Search & Filters Card */
    .search-filters-card {
        background: white;
        border-radius: 10px;
        box-shadow: var(--shadow);
        margin-bottom: 2rem;
        overflow: hidden;
    }
    
    .search-filters-card .card-header {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        padding: 1.5rem;
        border-bottom: 1px solid #dee2e6;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .search-filters-card h3 {
        margin: 0;
        color: var(--primary-blue);
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .header-actions {
        display: flex;
        gap: 0.8rem;
    }
    
    .btn-export,
    .btn-bulk {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.6rem 1.2rem;
        background: #f8f9fa;
        color: var(--text-dark);
        border: 1px solid #dee2e6;
        border-radius: 6px;
        font-weight: 600;
        transition: var(--transition);
    }
    
    .btn-export:hover,
    .btn-bulk:hover {
        background: #e9ecef;
        color: var(--primary-blue);
    }
    
    .search-filters-card .card-body {
        padding: 1.5rem;
    }
    
    .search-container {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .search-input-group {
        flex: 1;
        position: relative;
    }
    
    .search-icon {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-light);
    }
    
    .search-input {
        width: 100%;
        padding: 0.9rem 1rem 0.9rem 3rem;
        border: 2px solid #dee2e6;
        border-radius: 8px;
        font-size: 0.95rem;
        transition: var(--transition);
    }
    
    .search-input:focus {
        border-color: var(--secondary-blue);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        outline: none;
    }
    
    .search-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 0 0 8px 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        z-index: 100;
        display: none;
    }
    
    .search-suggestion {
        padding: 0.8rem 1rem;
        cursor: pointer;
        transition: var(--transition);
    }
    
    .search-suggestion:hover {
        background: #f8f9fa;
    }
    
    .search-btn {
        padding: 0.9rem 1.8rem;
        font-weight: 600;
    }
    
    .filter-options {
        display: flex;
        gap: 1.5rem;
        flex-wrap: wrap;
    }
    
    .filter-group {
        flex: 1;
        min-width: 200px;
    }
    
    .filter-label {
        display: block;
        margin-bottom: 0.5rem;
        color: var(--text-dark);
        font-weight: 600;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .filter-select {
        width: 100%;
        padding: 0.8rem 1rem;
        border: 2px solid #dee2e6;
        border-radius: 8px;
        background: white;
        font-size: 0.9rem;
        color: var(--text-dark);
        transition: var(--transition);
        cursor: pointer;
    }
    
    .filter-select:focus {
        border-color: var(--secondary-blue);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        outline: none;
    }
    
    /* Active Filters */
    .active-filters {
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid #e9ecef;
    }
    
    .filters-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.8rem;
        font-weight: 600;
        color: var(--text-dark);
        font-size: 0.9rem;
    }
    
    .filter-chips {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .filter-chip {
        background: rgba(52, 152, 219, 0.1);
        color: var(--secondary-blue);
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        font-size: 0.85rem;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .chip-remove {
        color: var(--text-light);
        text-decoration: none;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        transition: var(--transition);
    }
    
    .chip-remove:hover {
        background: rgba(0,0,0,0.1);
        color: var(--danger-red);
    }
    
    /* Employees List Card */
    .employees-list-card {
        background: white;
        border-radius: 10px;
        box-shadow: var(--shadow);
        margin-bottom: 2rem;
        overflow: hidden;
    }
    
    .employees-list-card .card-header {
        padding: 1.5rem;
        background: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .list-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .employees-count {
        font-weight: 600;
        color: var(--primary-blue);
        font-size: 1.1rem;
    }
    
    .view-toggle {
        display: flex;
        gap: 0.3rem;
        background: #e9ecef;
        padding: 0.3rem;
        border-radius: 6px;
    }
    
    .view-btn {
        width: 36px;
        height: 36px;
        border: none;
        background: none;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-light);
        cursor: pointer;
        transition: var(--transition);
    }
    
    .view-btn:hover {
        background: rgba(0,0,0,0.05);
        color: var(--text-dark);
    }
    
    .view-btn.active {
        background: white;
        color: var(--secondary-blue);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .employees-list-card .card-body {
        padding: 1.5rem;
    }
    
    /* Employees Grid */
    .employees-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .employee-card {
        background: white;
        border-radius: 10px;
        border: 1px solid #e9ecef;
        overflow: hidden;
        transition: var(--transition);
    }
    
    .employee-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border-color: var(--secondary-blue);
    }
    
    .employee-card-header {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        border-bottom: 1px solid #dee2e6;
    }
    
    .employee-avatar {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--secondary-blue), var(--accent-blue));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 1.4rem;
        color: white;
        flex-shrink: 0;
        position: relative;
    }
    
    .avatar-badge {
        position: absolute;
        bottom: -5px;
        right: -5px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        color: white;
        border: 2px solid white;
    }
    
    .admin-badge {
        background: linear-gradient(135deg, var(--purple), #8e44ad);
    }
    
    .staff-badge {
        background: linear-gradient(135deg, var(--warning-orange), #f39c12);
    }
    
    .employee-info {
        flex: 1;
    }
    
    .employee-name {
        margin: 0 0 0.2rem 0;
        color: var(--primary-blue);
        font-size: 1.1rem;
    }
    
    .employee-email {
        font-size: 0.85rem;
        color: var(--text-light);
        margin-bottom: 0.2rem;
    }
    
    .employee-id {
        font-size: 0.8rem;
        color: var(--text-light);
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }
    
    .employee-status {
        flex-shrink: 0;
    }
    
    .status-badge {
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
    }
    
    .status-active {
        background: rgba(39, 174, 96, 0.1);
        color: var(--success-green);
    }
    
    .status-inactive {
        background: rgba(149, 165, 166, 0.1);
        color: #95a5a6;
    }
    
    /* Employee Details */
    .employee-details {
        padding: 1.5rem;
    }
    
    .detail-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .detail-item:last-child {
        margin-bottom: 0;
    }
    
    .detail-item i {
        color: var(--secondary-blue);
        font-size: 1.1rem;
        width: 20px;
        text-align: center;
    }
    
    .detail-content {
        flex: 1;
    }
    
    .detail-label {
        display: block;
        font-size: 0.8rem;
        color: var(--text-light);
        margin-bottom: 0.2rem;
    }
    
    .detail-value {
        font-weight: 500;
        color: var(--text-dark);
    }
    
    /* Employee Stats */
    .employee-stats {
        padding: 1rem 1.5rem;
        background: #f8f9fa;
        border-top: 1px solid #e9ecef;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        gap: 1.5rem;
    }
    
    .employee-stat {
        display: flex;
        align-items: center;
        gap: 0.8rem;
    }
    
    .employee-stat i {
        color: var(--purple);
        font-size: 1.2rem;
    }
    
    .stat-content {
        display: flex;
        flex-direction: column;
    }
    
    .stat-number,
    .stat-status {
        font-weight: 600;
        color: var(--primary-blue);
        font-size: 1.1rem;
    }
    
    .stat-label {
        font-size: 0.8rem;
        color: var(--text-light);
    }
    
    /* Employee Actions */
    .employee-actions {
        padding: 1rem 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.8rem;
    }
    
    .action-group {
        display: flex;
        gap: 0.5rem;
    }
    
    .btn-action {
        flex: 1;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.5rem 0.8rem;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 500;
        text-decoration: none;
        transition: var(--transition);
        border: none;
        cursor: pointer;
    }
    
    .btn-edit {
        background: rgba(52, 152, 219, 0.1);
        color: var(--secondary-blue);
    }
    
    .btn-edit:hover {
        background: var(--secondary-blue);
        color: white;
    }
    
    .btn-salary {
        background: rgba(243, 156, 18, 0.1);
        color: var(--warning-orange);
    }
    
    .btn-salary:hover {
        background: var(--warning-orange);
        color: white;
    }
    
    .btn-role {
        background: rgba(155, 89, 182, 0.1);
        color: var(--purple);
    }
    
    .btn-role:hover {
        background: var(--purple);
        color: white;
    }
    
    .btn-promote {
        background: rgba(39, 174, 96, 0.1);
        color: var(--success-green);
    }
    
    .btn-promote:hover {
        background: var(--success-green);
        color: white;
    }
    
    .btn-terminate {
        background: rgba(231, 76, 60, 0.1);
        color: var(--danger-red);
    }
    
    .btn-terminate:hover {
        background: var(--danger-red);
        color: white;
    }
    
    .btn-history {
        background: rgba(149, 165, 166, 0.1);
        color: #95a5a6;
    }
    
    .btn-history:hover {
        background: #95a5a6;
        color: white;
    }
    
    /* Table View */
    .employees-data-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .employees-data-table thead {
        background: #f8f9fa;
    }
    
    .employees-data-table th {
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        color: var(--primary-blue);
        border-bottom: 2px solid #dee2e6;
        font-size: 0.9rem;
    }
    
    .employees-data-table td {
        padding: 1rem;
        border-bottom: 1px solid #e9ecef;
        vertical-align: middle;
    }
    
    .employees-data-table tbody tr:hover {
        background: #f8f9fa;
    }
    
    .table-employee-info {
        display: flex;
        align-items: center;
        gap: 0.8rem;
    }
    
    .table-avatar {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--secondary-blue), var(--accent-blue));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: white;
        font-size: 1rem;
    }
    
    .table-details {
        display: flex;
        flex-direction: column;
    }
    
    .table-name {
        font-weight: 600;
        color: var(--primary-blue);
    }
    
    .table-id {
        font-size: 0.8rem;
        color: var(--text-light);
    }
    
    .table-badge {
        padding: 0.3rem 0.6rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
        display: inline-block;
    }
    
    .table-badge.active {
        background: rgba(39, 174, 96, 0.1);
        color: var(--success-green);
    }
    
    .table-badge.inactive {
        background: rgba(149, 165, 166, 0.1);
        color: #95a5a6;
    }
    
    .table-badge.admin {
        background: rgba(155, 89, 182, 0.1);
        color: var(--purple);
    }
    
    .table-badge.staff {
        background: rgba(243, 156, 18, 0.1);
        color: var(--warning-orange);
    }
    
    .table-badge.user {
        background: rgba(52, 152, 219, 0.1);
        color: var(--secondary-blue);
    }
    
    .table-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .table-action {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f8f9fa;
        color: var(--text-dark);
        text-decoration: none;
        transition: var(--transition);
    }
    
    .table-action:hover {
        background: var(--secondary-blue);
        color: white;
    }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
    }
    
    .empty-icon {
        font-size: 4rem;
        color: #e9ecef;
        margin-bottom: 1.5rem;
    }
    
    .empty-state h3 {
        color: var(--text-light);
        margin-bottom: 0.5rem;
    }
    
    .empty-state p {
        color: var(--text-light);
        opacity: 0.8;
        margin-bottom: 2rem;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
    }
    
    /* Pagination */
    .pagination-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem;
        border-top: 1px solid #e9ecef;
        background: #f8f9fa;
    }
    
    .pagination-info {
        color: var(--text-light);
        font-size: 0.9rem;
    }
    
    .pagination {
        display: flex;
        gap: 0.5rem;
    }
    
    .pagination-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        background: white;
        color: var(--text-dark);
        text-decoration: none;
        font-weight: 500;
        transition: var(--transition);
    }
    
    .pagination-btn:hover:not(.active) {
        background: #f8f9fa;
        border-color: var(--secondary-blue);
        color: var(--secondary-blue);
    }
    
    .pagination-btn.active {
        background: var(--secondary-blue);
        border-color: var(--secondary-blue);
        color: white;
    }
    
    /* Quick Stats */
    .quick-stats-card {
        background: white;
        border-radius: 10px;
        box-shadow: var(--shadow);
        padding: 1.5rem;
    }
    
    .quick-stats-card h3 {
        color: var(--primary-blue);
        margin: 0 0 1.5rem 0;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .stats-grid-small {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }
    
    .stat-item-small {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e9ecef;
    }
    
    .stat-icon-small {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--secondary-blue), var(--accent-blue));
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        color: white;
        flex-shrink: 0;
    }
    
    .stat-content-small {
        display: flex;
        flex-direction: column;
    }
    
    .stat-number-small {
        font-weight: 700;
        color: var(--primary-blue);
        font-size: 1.2rem;
    }
    
    .stat-label-small {
        font-size: 0.8rem;
        color: var(--text-light);
    }
    
    /* Responsive */
    @media screen and (max-width: 768px) {
        .header-content {
            flex-direction: column;
            gap: 1rem;
            text-align: center;
        }
        
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .search-container {
            flex-direction: column;
        }
        
        .filter-options {
            flex-direction: column;
        }
        
        .header-actions {
            flex-direction: column;
            width: 100%;
        }
        
        .header-actions .btn {
            width: 100%;
            justify-content: center;
        }
        
        .employees-grid {
            grid-template-columns: 1fr;
        }
        
        .employee-card-header {
            flex-direction: column;
            text-align: center;
        }
        
        .employee-avatar {
            width: 80px;
            height: 80px;
            font-size: 1.8rem;
        }
        
        .employee-actions {
            flex-direction: column;
        }
        
        .action-group {
            width: 100%;
        }
        
        .pagination-container {
            flex-direction: column;
            gap: 1rem;
            text-align: center;
        }
        
        .stats-grid-small {
            grid-template-columns: 1fr;
        }
        
        .employees-data-table {
            display: block;
            overflow-x: auto;
        }
    }
    
    @media screen and (max-width: 480px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .filter-chips {
            flex-direction: column;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle between grid and list view
        const viewButtons = document.querySelectorAll('.view-btn');
        const employeesView = document.getElementById('employeesView');
        const employeesTable = document.getElementById('employeesTable');
        
        viewButtons.forEach(button => {
            button.addEventListener('click', function() {
                const view = this.dataset.view;
                
                // Update active button
                viewButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Show/hide views
                if (view === 'grid') {
                    employeesView.style.display = 'grid';
                    employeesTable.style.display = 'none';
                } else {
                    employeesView.style.display = 'none';
                    employeesTable.style.display = 'block';
                }
                
                // Save preference to localStorage
                localStorage.setItem('employeesViewPreference', view);
            });
        });
        
        // Load saved view preference
        const savedView = localStorage.getItem('employeesViewPreference');
        if (savedView === 'list') {
            document.querySelector('[data-view="list"]').click();
        }
        
        // Search suggestions
        const searchInput = document.querySelector('.search-input');
        const suggestionsContainer = document.getElementById('search-suggestions');
        
        // Sample search suggestions (in a real app, these would come from an API)
        const sampleSuggestions = [
            'Nom: Dupont Jean',
            'Email: jean.dupont@hotel.com',
            'Poste: Réceptionniste',
            'Poste: Manager',
            'Poste: Nettoyage'
        ];
        
        searchInput.addEventListener('input', function(e) {
            const value = e.target.value.trim();
            suggestionsContainer.innerHTML = '';
            
            if (value.length > 2) {
                // Filter suggestions based on input
                const filtered = sampleSuggestions.filter(s => 
                    s.toLowerCase().includes(value.toLowerCase())
                );
                
                if (filtered.length > 0) {
                    filtered.forEach(suggestion => {
                        const div = document.createElement('div');
                        div.className = 'search-suggestion';
                        div.textContent = suggestion;
                        div.addEventListener('click', function() {
                            searchInput.value = suggestion.split(': ')[1];
                            suggestionsContainer.style.display = 'none';
                            searchInput.focus();
                        });
                        suggestionsContainer.appendChild(div);
                    });
                    suggestionsContainer.style.display = 'block';
                } else {
                    suggestionsContainer.style.display = 'none';
                }
            } else {
                suggestionsContainer.style.display = 'none';
            }
        });
        
        // Close suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                suggestionsContainer.style.display = 'none';
            }
        });
        
        // Export functionality
        window.exportEmployees = function() {
            const format = prompt('Choisissez le format d\'export:\n1. Excel (XLSX)\n2. CSV\n3. PDF\n\nEntrez le numéro:', '1');
            
            if (format) {
                let fileType;
                switch(format) {
                    case '1':
                        fileType = 'Excel';
                        break;
                    case '2':
                        fileType = 'CSV';
                        break;
                    case '3':
                        fileType = 'PDF';
                        break;
                    default:
                        alert('Format invalide');
                        return;
                }
                
                // Get current filters
                const filters = {
                    q: searchInput.value || '',
                    poste: document.querySelector('[name="poste"]').value || '',
                    is_active: document.querySelector('[name="is_active"]').value || '',
                    sort: document.querySelector('[name="sort"]').value || ''
                };
                
                alert(`Export ${fileType} démarré...\n\nFiltres appliqués:\n• Recherche: ${filters.q || 'Aucune'}\n• Poste: ${filters.poste || 'Tous'}\n• Statut: ${filters.is_active === '1' ? 'Actifs' : filters.is_active === '0' ? 'Inactifs' : 'Tous'}\n\nLe téléchargement commencera automatiquement.`);
            }
        };
        
        // Bulk actions
        window.showBulkActions = function() {
            const actions = prompt(
                'Actions groupées disponibles:\n\n' +
                '1. Activer plusieurs comptes\n' +
                '2. Désactiver plusieurs comptes\n' +
                '3. Modifier le poste\n' +
                '4. Ajouter une prime\n' +
                '5. Envoyer un email\n\n' +
                'Entrez le numéro de l\'action:',
                '1'
            );
            
            if (actions) {
                alert(`L'action ${actions} sera bientôt disponible. Dans la version complète, vous pourrez sélectionner plusieurs employés pour effectuer cette action.`);
            }
        };
        
        // Auto-submit filters on change
        document.querySelectorAll('.filter-select').forEach(select => {
            select.addEventListener('change', function() {
                this.form.submit();
            });
        });
        
        // Highlight active search
        if (searchInput.value) {
            searchInput.style.borderColor = 'var(--secondary-blue)';
            searchInput.style.boxShadow = '0 0 0 3px rgba(52, 152, 219, 0.1)';
        }
        
        // Add keyboard shortcut for new employee (Ctrl/Cmd + N)
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                window.location.href = "{% url 'create_employee' %}";
            }
        });
        
        // Tooltip for keyboard shortcut
        const addBtn = document.querySelector('.btn-add-employee');
        if (addBtn) {
            addBtn.title = 'Ctrl/Cmd + N';
        }
    });
</script>
{% endblock %}